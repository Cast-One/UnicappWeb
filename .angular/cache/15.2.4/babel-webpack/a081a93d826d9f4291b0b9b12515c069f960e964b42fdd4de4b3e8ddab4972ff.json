{"ast":null,"code":"import Swal from 'sweetalert2';\nimport { PurchaseSummaryDialogComponent } from '../purchase-summary-dialog/purchase-summary-dialog.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/material/dialog\";\nimport * as i2 from \"@angular/material/snack-bar\";\nimport * as i3 from \"../api.service\";\nimport * as i4 from \"@angular/common\";\nimport * as i5 from \"@angular/material/button\";\nconst _c0 = function (a0) {\n  return {\n    \"bg-green-100\": a0\n  };\n};\nconst _c1 = function (a0) {\n  return {\n    \"text-red-500\": a0\n  };\n};\nfunction ProductSelectorComponent_div_2_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r4 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 11);\n    i0.ɵɵlistener(\"click\", function ProductSelectorComponent_div_2_Template_div_click_0_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r4);\n      const product_r2 = restoredCtx.$implicit;\n      const ctx_r3 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r3.selectProduct(product_r2));\n    });\n    i0.ɵɵelement(1, \"img\", 12);\n    i0.ɵɵelementStart(2, \"p\", 13);\n    i0.ɵɵtext(3);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(4, \"p\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\", 14);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()();\n  }\n  if (rf & 2) {\n    const product_r2 = ctx.$implicit;\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(6, _c0, product_r2.selected));\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"src\", product_r2.image, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate(product_r2.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Precio: $\", product_r2.sale_price, \"\");\n    i0.ɵɵadvance(1);\n    i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(8, _c1, product_r2.stock === 0));\n    i0.ɵɵadvance(1);\n    i0.ɵɵtextInterpolate1(\"Stock: \", product_r2.stock, \"\");\n  }\n}\nfunction ProductSelectorComponent_div_7_Template(rf, ctx) {\n  if (rf & 1) {\n    const _r8 = i0.ɵɵgetCurrentView();\n    i0.ɵɵelementStart(0, \"div\", 15)(1, \"div\", 16);\n    i0.ɵɵelement(2, \"img\", 17);\n    i0.ɵɵelementStart(3, \"div\", 18)(4, \"p\");\n    i0.ɵɵtext(5);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(6, \"p\", 19);\n    i0.ɵɵtext(7);\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(8, \"button\", 20);\n    i0.ɵɵlistener(\"click\", function ProductSelectorComponent_div_7_Template_button_click_8_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r8);\n      const product_r5 = restoredCtx.$implicit;\n      const ctx_r7 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r7.addProduct(product_r5));\n    });\n    i0.ɵɵtext(9, \"+\");\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(10, \"button\", 21);\n    i0.ɵɵlistener(\"click\", function ProductSelectorComponent_div_7_Template_button_click_10_listener() {\n      const restoredCtx = i0.ɵɵrestoreView(_r8);\n      const product_r5 = restoredCtx.$implicit;\n      const i_r6 = restoredCtx.index;\n      const ctx_r9 = i0.ɵɵnextContext();\n      return i0.ɵɵresetView(ctx_r9.subtractProduct(product_r5, i_r6));\n    });\n    i0.ɵɵtext(11, \"-\");\n    i0.ɵɵelementEnd()();\n    i0.ɵɵelementStart(12, \"div\", 22)(13, \"p\");\n    i0.ɵɵtext(14);\n    i0.ɵɵelementEnd();\n    i0.ɵɵelementStart(15, \"p\");\n    i0.ɵɵtext(16);\n    i0.ɵɵelementEnd()()();\n  }\n  if (rf & 2) {\n    const product_r5 = ctx.$implicit;\n    i0.ɵɵadvance(2);\n    i0.ɵɵproperty(\"src\", product_r5.image, i0.ɵɵsanitizeUrl);\n    i0.ɵɵadvance(3);\n    i0.ɵɵtextInterpolate(product_r5.name);\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"x\", product_r5.quantity, \"\");\n    i0.ɵɵadvance(7);\n    i0.ɵɵtextInterpolate1(\"Precio unitario: $\", product_r5.sale_price, \"\");\n    i0.ɵɵadvance(2);\n    i0.ɵɵtextInterpolate1(\"Precio total: $\", product_r5.sale_price * product_r5.quantity, \"\");\n  }\n}\nconst _c2 = function (a0) {\n  return {\n    \"dark\": a0\n  };\n};\nexport class ProductSelectorComponent {\n  constructor(dialog, snackBar, apiService) {\n    this.dialog = dialog;\n    this.snackBar = snackBar;\n    this.apiService = apiService;\n    this.products = [];\n    this.selectedProducts = [];\n  }\n  ngOnInit() {\n    this.resetAndFetchProducts();\n  }\n  getProducts() {\n    this.apiService.getProducts().subscribe(data => {\n      this.products = data.Data;\n      // this.products = data;\n    }, error => {\n      console.error('Error al obtener productos:', error);\n    });\n  }\n  resetAndFetchProducts() {\n    this.selectedProducts = [];\n    this.apiService.getProducts().subscribe(data => {\n      this.products = data.Data;\n    }, error => {\n      console.error('Error al obtener productos:', error);\n    });\n  }\n  // products: Product[] = [\n  //   { code: '7501000624089', name: 'Arcoiris', stock: 4, purchase_price: 5.91, sale_price: 6.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00750100062408L.jpg?odnHeight=612&odnWidth=612&odnBg=FFFFFF' },\n  //   { code: '75003135', name: 'Boing Guayaba', stock: 4, purchase_price: 10.25, sale_price: 12.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00000007500177L.jpg' },\n  //   { code: '75003104', name: 'Boing Mango', stock: 4, purchase_price: 10.25, sale_price: 12.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00000007500175L.jpg?odnHeight=612&odnWidth=612&odnBg=FFFFFF' },\n  //   { code: '75003159', name: 'Boing Manzana', stock: 3, purchase_price: 10.25, sale_price: 12.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00000007500179L.jpg?odnHeight=612&odnWidth=612&odnBg=FFFFFF' },\n  //   { code: '7501011128323', name: 'Cheetos', stock: 5, purchase_price: 4.67, sale_price: 7.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00750101112832L.jpg?odnHeight=612&odnWidth=612&odnBg=FFFFFF' },\n  //   { code: '7500478023363', name: 'Cheetos Flamming Hot', stock: 3, purchase_price: 4.67, sale_price: 7.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00750047802336L.jpg?odnHeight=612&odnWidth=612&odnBg=FFFFFF' },\n  //   { code: '7500478008247', name: 'Chokis', stock: 4, purchase_price: 5.91, sale_price: 6.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00750047800824L.jpg?odnHeight=612&odnWidth=612&odnBg=FFFFFF' },\n  //   { code: '7501011132191', name: 'Churrumais', stock: 7, purchase_price: 4.67, sale_price: 7.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00750047800200L.jpg?odnHeight=612&odnWidth=612&odnBg=FFFFFF' },\n  //   { code: '7501011125704', name: 'Doritos', stock: 8, purchase_price: 4.67, sale_price: 7.0, image: 'https://m.media-amazon.com/images/I/71MhS674spL._AC_SX679_.jpg' },\n  //   { code: '7500478012398', name: 'Emperador Sabor Chocolate', stock: 5, purchase_price: 5.91, sale_price: 5.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00750047801239L.jpg' },\n  //   { code: '7500478012404', name: 'Emperador Sabor Vainilla', stock: 6, purchase_price: 5.91, sale_price: 5.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00750047801240L.jpg?odnHeight=612&odnWidth=612&odnBg=FFFFFF' },\n  //   { code: '7501031360130', name: 'Manzanita Sol', stock: 3, purchase_price: 8.25, sale_price: 10.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00750103136013L.jpg' },\n  //   { code: '7501030419037', name: 'Mini Gansito', stock: 22, purchase_price: 5.29, sale_price: 6.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00750103041903L.jpg?odnHeight=612&odnWidth=612&odnBg=FFFFFF' },\n  //   { code: '7501000630363', name: 'Mini Mamut', stock: 16, purchase_price: 2.2, sale_price: 3.0, image: 'https://cdn.shopify.com/s/files/1/0372/4450/2149/products/farm1_9446eb12-17ff-4004-b79d-fc2fb98cc282_1200x1200.jpg?v=1596841679' },\n  //   { code: '7501031346301', name: 'Mirinda', stock: 1, purchase_price: 8.25, sale_price: 10.0, image: 'https://despensaurbana.mx/content/images/thumbs/5f0e5fe51721854af7ff0c7b_Refresco_Mirinda_Lata_355_Ml_24_Pz_KYGMAU4OEH.jpg.png' },\n  //   { code: '040697741541', name: 'Muffins', stock: 20, purchase_price: 5.6, sale_price: 5.0, image: 'https://img.freepik.com/fotos-premium/cupcake-chispas-chocolate-sobre-fondo-blanco_319172-1105.jpg?w=2000' },\n  //   { code: '75000011', name: 'Nesquik', stock: 11, purchase_price: 9.76, sale_price: 10.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00000007500001L.jpg' },\n  //   { code: '7501031311309', name: 'Pepsi', stock: 2, purchase_price: 8.25, sale_price: 10.0, image: 'https://despensaurbana.mx/content/images/thumbs/5f0e5fe51721854af7ff0c75_refresco-pepsi-regular-lata-355-ml.png' },\n  //   { code: '7501011125322', name: 'Rancheritos', stock: 8, purchase_price: 4.67, sale_price: 7.0, image: 'https://images.albertsons-media.com/is/image/ABS/960544064-ECOM?$ng-ecom-pdp-desktop$&defaultImage=Not_Available' },\n  //   { code: '7500478015610', name: 'Ruffles', stock: 6, purchase_price: 4.67, sale_price: 7.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00750047801561L1.jpg' },\n  //   { code: '7501011101005', name: 'Sabritas', stock: 2, purchase_price: 4.67, sale_price: 7.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00750101110100L.jpg?odnHeight=612&odnWidth=612&odnBg=FFFFFF' },\n  //   { code: '7501071120091', name: 'Squirt', stock: 3, purchase_price: 8.25, sale_price: 10.0, image: 'https://www.pidefacilraul.com/cms/wp-content/uploads/2020/05/09-192.jpg' },\n  // ];\n  getTotal() {\n    return this.selectedProducts.reduce((total, product) => total + product.sale_price * (product.quantity || 1), 0);\n  }\n  selectProduct(product) {\n    if (product.stock === 0) {\n      alert('Este producto no tiene stock disponible.');\n      return;\n    }\n    if (!product.selected) {\n      product.selected = true;\n      product.quantity = 1;\n    } else {\n      product.quantity += 1;\n    }\n    product.stock -= 1;\n    if (!this.selectedProducts.includes(product)) {\n      this.selectedProducts.push(product);\n    }\n  }\n  removeProduct(index) {\n    this.selectedProducts[index].selected = false;\n    this.selectedProducts.splice(index, 1);\n  }\n  addProduct(product) {\n    if (product.stock === 0) {\n      alert('Este producto no tiene stock disponible.');\n      return;\n    }\n    product.stock -= 1;\n    product.quantity += 1;\n  }\n  subtractProduct(product, index) {\n    if (product.quantity > 1) {\n      product.stock += 1;\n      product.quantity -= 1;\n    } else {\n      this.removeProduct(index);\n    }\n  }\n  openPurchaseSummaryDialog() {\n    if (this.selectedProducts.length === 0) {\n      this.showSnackBar('Seleccione al menos un producto para comprar');\n      return;\n    }\n    const dialogRef = this.dialog.open(PurchaseSummaryDialogComponent, {\n      data: {\n        selectedProducts: this.selectedProducts,\n        total: this.getTotal(),\n        userID: '',\n        amountToPay: 0,\n        purchase: () => {\n          dialogRef.close({\n            userID: dialogRef.componentInstance.data.userID,\n            amountToPay: dialogRef.componentInstance.data.amountToPay\n          });\n        }\n      }\n    });\n    dialogRef.afterClosed().subscribe(result => {\n      if (result) {\n        const userID = result.userID;\n        const amountToPay = result.amountToPay;\n        this.createBuy(userID, amountToPay, this.selectedProducts);\n      }\n    });\n  }\n  showSnackBar(message) {\n    this.snackBar.open(message, 'Cerrar', {\n      duration: 5000,\n      horizontalPosition: 'center',\n      verticalPosition: 'top'\n    });\n  }\n  createBuy(clientCode, payment, selectedProducts) {\n    var productsRequest = [];\n    var productSelected;\n    selectedProducts.forEach(product => {\n      productSelected = {\n        'product': product.id,\n        'quantity': product.quantity\n      };\n      productsRequest.push(productSelected);\n    });\n    var buyRequest = {\n      'client_code': clientCode,\n      'payment': payment,\n      'products': productsRequest\n    };\n    this.apiService.createBuy(buyRequest).subscribe(response => {\n      let successMessage = '¡Compra realizada exitosamente!';\n      if (response.Data && response.Data.remaining_amount !== 0) {\n        successMessage += ` Recuerda que quedan pendiente el pago de $${response.Data.remaining_amount} pesos`;\n      }\n      this.showSuccessAlert('Éxito', successMessage);\n      this.resetAndFetchProducts();\n    }, error => {\n      let errorMessage = error.error.Message.client_code[0];\n      if (errorMessage.includes('There is no user with code')) {\n        const clientCode = buyRequest.client_code;\n        errorMessage = `No existe un usuario registrado con el código ${clientCode}, revisa los datos e intenta nuevamente`;\n      }\n      this.showErrorAlert('Error', errorMessage);\n    });\n  }\n  showSuccessAlert(title, text) {\n    Swal.fire({\n      title: title,\n      text: text,\n      icon: 'success',\n      confirmButtonText: 'Aceptar',\n      customClass: {\n        container: 'custom-alert'\n      }\n    });\n  }\n  showErrorAlert(title, text) {\n    Swal.fire({\n      title: title,\n      text: text,\n      icon: 'error',\n      confirmButtonText: 'Aceptar',\n      customClass: {\n        container: 'custom-alert'\n      }\n    });\n  }\n}\nProductSelectorComponent.ɵfac = function ProductSelectorComponent_Factory(t) {\n  return new (t || ProductSelectorComponent)(i0.ɵɵdirectiveInject(i1.MatDialog), i0.ɵɵdirectiveInject(i2.MatSnackBar), i0.ɵɵdirectiveInject(i3.ApiService));\n};\nProductSelectorComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: ProductSelectorComponent,\n  selectors: [[\"app-product-selector\"]],\n  decls: 15,\n  vars: 8,\n  consts: [[1, \"flex\", \"h-full\"], [1, \"grid\", \"grid-cols-3\", \"gap-4\", \"w-3/4\", \"h-full\", \"overflow-auto\"], [\"class\", \"border p-4 rounded shadow\", 3, \"ngClass\", \"click\", 4, \"ngFor\", \"ngForOf\"], [1, \"border-l\", \"w-1/4\", \"p-4\", \"h-full\", \"sticky\", \"top-0\", \"flex\", \"flex-col\"], [1, \"text-xl\", \"font-semibold\", \"mb-4\"], [1, \"selected-products\", \"flex-grow\"], [\"class\", \"mb-4\", 4, \"ngFor\", \"ngForOf\"], [1, \"border-t\", \"mt-4\", \"pt-4\"], [1, \"font-semibold\"], [\"mat-raised-button\", \"\", \"color\", \"primary\", 1, \"w-full\", \"my-4\", \"py-2\", \"text-lg\", \"font-bold\", 3, \"click\"], [1, \"flex\", \"h-full\", 3, \"ngClass\"], [1, \"border\", \"p-4\", \"rounded\", \"shadow\", 3, \"ngClass\", \"click\"], [1, \"h-32\", \"w-32\", \"mx-auto\", \"mb-4\", 3, \"src\"], [1, \"font-semibold\", \"text-lg\"], [3, \"ngClass\"], [1, \"mb-4\"], [1, \"grid\", \"grid-cols-6\", \"gap-2\", \"items-center\"], [1, \"h-16\", \"w-16\", \"col-span-1\", 3, \"src\"], [1, \"col-span-3\"], [1, \"text-sm\", \"text-gray-500\"], [1, \"bg-blue-500\", \"text-white\", \"px-2\", \"py-1\", \"rounded\", \"col-span-1\", 3, \"click\"], [1, \"bg-red-500\", \"text-white\", \"px-2\", \"py-1\", \"rounded\", \"col-span-1\", 3, \"click\"], [1, \"flex\", \"justify-between\"]],\n  template: function ProductSelectorComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0)(1, \"div\", 1);\n      i0.ɵɵtemplate(2, ProductSelectorComponent_div_2_Template, 8, 10, \"div\", 2);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(3, \"div\", 3)(4, \"h2\", 4);\n      i0.ɵɵtext(5, \"Productos seleccionados\");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(6, \"div\", 5);\n      i0.ɵɵtemplate(7, ProductSelectorComponent_div_7_Template, 17, 5, \"div\", 6);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(8, \"div\", 7)(9, \"p\", 8);\n      i0.ɵɵtext(10);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(11, \"button\", 9);\n      i0.ɵɵlistener(\"click\", function ProductSelectorComponent_Template_button_click_11_listener() {\n        return ctx.openPurchaseSummaryDialog();\n      });\n      i0.ɵɵtext(12, \" Comprar \");\n      i0.ɵɵelementEnd()()()();\n      i0.ɵɵelement(13, \"div\", 10);\n      i0.ɵɵpipe(14, \"async\");\n    }\n    if (rf & 2) {\n      i0.ɵɵadvance(2);\n      i0.ɵɵproperty(\"ngForOf\", ctx.products);\n      i0.ɵɵadvance(5);\n      i0.ɵɵproperty(\"ngForOf\", ctx.selectedProducts);\n      i0.ɵɵadvance(3);\n      i0.ɵɵtextInterpolate1(\"Total: $\", ctx.getTotal(), \"\");\n      i0.ɵɵadvance(3);\n      i0.ɵɵproperty(\"ngClass\", i0.ɵɵpureFunction1(6, _c2, i0.ɵɵpipeBind1(14, 4, ctx.themeService.isDarkTheme$)));\n    }\n  },\n  dependencies: [i4.NgClass, i4.NgForOf, i5.MatButton, i4.AsyncPipe],\n  styles: [\".selected-products[_ngcontent-%COMP%] {\\n  max-height: calc(100vh - 12rem);\\n  overflow-y: auto;\\n}\\n/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8uL3NyYy9hcHAvcHJvZHVjdC1zZWxlY3Rvci9wcm9kdWN0LXNlbGVjdG9yLmNvbXBvbmVudC5zY3NzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBO0VBQ0ksK0JBQUE7RUFDQSxnQkFBQTtBQUNKIiwic291cmNlc0NvbnRlbnQiOlsiLnNlbGVjdGVkLXByb2R1Y3RzIHtcbiAgICBtYXgtaGVpZ2h0OiBjYWxjKDEwMHZoIC0gMTJyZW0pO1xuICAgIG92ZXJmbG93LXk6IGF1dG87XG4gIH0iXSwic291cmNlUm9vdCI6IiJ9 */\"]\n});","map":{"version":3,"mappings":"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","names":["Swal","PurchaseSummaryDialogComponent","i0","ProductSelectorComponent","constructor","dialog","snackBar","apiService","ngOnInit","resetAndFetchProducts","getProducts","subscribe","data","products","Data","error","console","selectedProducts","getTotal","reduce","total","product","sale_price","quantity","selectProduct","stock","alert","selected","includes","push","removeProduct","index","splice","addProduct","subtractProduct","openPurchaseSummaryDialog","length","showSnackBar","dialogRef","open","userID","amountToPay","purchase","close","componentInstance","afterClosed","result","createBuy","message","duration","horizontalPosition","verticalPosition","clientCode","payment","productsRequest","productSelected","forEach","id","buyRequest","response","successMessage","remaining_amount","showSuccessAlert","errorMessage","Message","client_code","showErrorAlert","title","text","fire","icon","confirmButtonText","customClass","container","selectors","decls","vars","consts","template","ctx"],"sourceRoot":"","sources":["/Users/macbook/Documents/GitHub/UnicappWeb/src/app/product-selector/product-selector.component.ts","/Users/macbook/Documents/GitHub/UnicappWeb/src/app/product-selector/product-selector.component.html"],"sourcesContent":["import { Component } from '@angular/core';\nimport { MatDialog } from '@angular/material/dialog';\nimport { MatSnackBar } from '@angular/material/snack-bar';\nimport Swal from 'sweetalert2';\nimport { ApiService } from '../api.service';\nimport { BuyRequest } from '../models/buy-request';\nimport { Product } from '../models/product';\nimport { ProductRequest } from '../models/product-request';\nimport { ResponseProducts } from '../models/response';\nimport { PurchaseSummaryDialogComponent } from '../purchase-summary-dialog/purchase-summary-dialog.component';\n\n@Component({\n  selector: 'app-product-selector',\n  templateUrl: './product-selector.component.html',\n  styleUrls: ['./product-selector.component.scss']\n})\nexport class ProductSelectorComponent {\n\n  constructor(private dialog: MatDialog, private snackBar: MatSnackBar, private apiService: ApiService) {}\n\n  products: Product[] = [];\n  selectedProducts: Product[] = [];\n\n  ngOnInit(): void {\n    this.resetAndFetchProducts()\n  }\n\n  getProducts(){\n    this.apiService.getProducts().subscribe(\n      \n      (data: ResponseProducts) => {\n        this.products = data.Data;\n        // this.products = data;\n      },\n      (error) => {\n        console.error('Error al obtener productos:', error);\n      }\n    );\n  }\n\n  resetAndFetchProducts(): void {\n    this.selectedProducts = [];\n    this.apiService.getProducts().subscribe(\n      (data: ResponseProducts) => {\n        this.products = data.Data;\n      },\n      (error) => {\n        console.error('Error al obtener productos:', error);\n      }\n    );\n  }\n  \n\n\n\n  // products: Product[] = [\n  //   { code: '7501000624089', name: 'Arcoiris', stock: 4, purchase_price: 5.91, sale_price: 6.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00750100062408L.jpg?odnHeight=612&odnWidth=612&odnBg=FFFFFF' },\n  //   { code: '75003135', name: 'Boing Guayaba', stock: 4, purchase_price: 10.25, sale_price: 12.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00000007500177L.jpg' },\n  //   { code: '75003104', name: 'Boing Mango', stock: 4, purchase_price: 10.25, sale_price: 12.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00000007500175L.jpg?odnHeight=612&odnWidth=612&odnBg=FFFFFF' },\n  //   { code: '75003159', name: 'Boing Manzana', stock: 3, purchase_price: 10.25, sale_price: 12.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00000007500179L.jpg?odnHeight=612&odnWidth=612&odnBg=FFFFFF' },\n  //   { code: '7501011128323', name: 'Cheetos', stock: 5, purchase_price: 4.67, sale_price: 7.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00750101112832L.jpg?odnHeight=612&odnWidth=612&odnBg=FFFFFF' },\n  //   { code: '7500478023363', name: 'Cheetos Flamming Hot', stock: 3, purchase_price: 4.67, sale_price: 7.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00750047802336L.jpg?odnHeight=612&odnWidth=612&odnBg=FFFFFF' },\n  //   { code: '7500478008247', name: 'Chokis', stock: 4, purchase_price: 5.91, sale_price: 6.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00750047800824L.jpg?odnHeight=612&odnWidth=612&odnBg=FFFFFF' },\n  //   { code: '7501011132191', name: 'Churrumais', stock: 7, purchase_price: 4.67, sale_price: 7.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00750047800200L.jpg?odnHeight=612&odnWidth=612&odnBg=FFFFFF' },\n  //   { code: '7501011125704', name: 'Doritos', stock: 8, purchase_price: 4.67, sale_price: 7.0, image: 'https://m.media-amazon.com/images/I/71MhS674spL._AC_SX679_.jpg' },\n  //   { code: '7500478012398', name: 'Emperador Sabor Chocolate', stock: 5, purchase_price: 5.91, sale_price: 5.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00750047801239L.jpg' },\n  //   { code: '7500478012404', name: 'Emperador Sabor Vainilla', stock: 6, purchase_price: 5.91, sale_price: 5.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00750047801240L.jpg?odnHeight=612&odnWidth=612&odnBg=FFFFFF' },\n  //   { code: '7501031360130', name: 'Manzanita Sol', stock: 3, purchase_price: 8.25, sale_price: 10.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00750103136013L.jpg' },\n  //   { code: '7501030419037', name: 'Mini Gansito', stock: 22, purchase_price: 5.29, sale_price: 6.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00750103041903L.jpg?odnHeight=612&odnWidth=612&odnBg=FFFFFF' },\n  //   { code: '7501000630363', name: 'Mini Mamut', stock: 16, purchase_price: 2.2, sale_price: 3.0, image: 'https://cdn.shopify.com/s/files/1/0372/4450/2149/products/farm1_9446eb12-17ff-4004-b79d-fc2fb98cc282_1200x1200.jpg?v=1596841679' },\n  //   { code: '7501031346301', name: 'Mirinda', stock: 1, purchase_price: 8.25, sale_price: 10.0, image: 'https://despensaurbana.mx/content/images/thumbs/5f0e5fe51721854af7ff0c7b_Refresco_Mirinda_Lata_355_Ml_24_Pz_KYGMAU4OEH.jpg.png' },\n  //   { code: '040697741541', name: 'Muffins', stock: 20, purchase_price: 5.6, sale_price: 5.0, image: 'https://img.freepik.com/fotos-premium/cupcake-chispas-chocolate-sobre-fondo-blanco_319172-1105.jpg?w=2000' },\n  //   { code: '75000011', name: 'Nesquik', stock: 11, purchase_price: 9.76, sale_price: 10.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00000007500001L.jpg' },\n  //   { code: '7501031311309', name: 'Pepsi', stock: 2, purchase_price: 8.25, sale_price: 10.0, image: 'https://despensaurbana.mx/content/images/thumbs/5f0e5fe51721854af7ff0c75_refresco-pepsi-regular-lata-355-ml.png' },\n  //   { code: '7501011125322', name: 'Rancheritos', stock: 8, purchase_price: 4.67, sale_price: 7.0, image: 'https://images.albertsons-media.com/is/image/ABS/960544064-ECOM?$ng-ecom-pdp-desktop$&defaultImage=Not_Available' },\n  //   { code: '7500478015610', name: 'Ruffles', stock: 6, purchase_price: 4.67, sale_price: 7.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00750047801561L1.jpg' },\n  //   { code: '7501011101005', name: 'Sabritas', stock: 2, purchase_price: 4.67, sale_price: 7.0, image: 'https://res.cloudinary.com/walmart-labs/image/upload/d_default.jpg/w_960,dpr_auto,f_auto,q_auto:best/gr/images/product-images/img_large/00750101110100L.jpg?odnHeight=612&odnWidth=612&odnBg=FFFFFF' },\n  //   { code: '7501071120091', name: 'Squirt', stock: 3, purchase_price: 8.25, sale_price: 10.0, image: 'https://www.pidefacilraul.com/cms/wp-content/uploads/2020/05/09-192.jpg' },\n  // ];\n\n\n\n  getTotal(): number {\n    return this.selectedProducts.reduce((total, product) => total + (product.sale_price * (product.quantity || 1)), 0);\n  }\n  \n\n  selectProduct(product: Product): void {\n    if (product.stock === 0) {\n      alert('Este producto no tiene stock disponible.');\n      return;\n    }\n  \n    if (!product.selected) {\n      product.selected = true;\n      product.quantity = 1;\n    } else {\n      product.quantity! += 1;\n    }\n  \n    product.stock -= 1;\n    if (!this.selectedProducts.includes(product)) {\n      this.selectedProducts.push(product);\n    }\n  }\n  \n\n  removeProduct(index: number): void {\n    this.selectedProducts[index].selected = false;\n    this.selectedProducts.splice(index, 1);\n  }\n\n  addProduct(product: Product): void {\n    if (product.stock === 0) {\n      alert('Este producto no tiene stock disponible.');\n      return;\n    }\n  \n    product.stock -= 1;\n    product.quantity! += 1;\n  }\n  \n  subtractProduct(product: Product, index: number): void {\n    if (product.quantity! > 1) {\n      product.stock += 1;\n      product.quantity! -= 1;\n    } else {\n      this.removeProduct(index);\n    }\n  }\n  \n  openPurchaseSummaryDialog() {\n    if (this.selectedProducts.length === 0) {\n      this.showSnackBar('Seleccione al menos un producto para comprar');\n      return;\n    }\n  \n    const dialogRef = this.dialog.open(PurchaseSummaryDialogComponent, {\n      data: {\n        selectedProducts: this.selectedProducts,\n        total: this.getTotal(),\n        userID: '',\n        amountToPay: 0,\n        purchase: () => {\n          dialogRef.close({\n            userID: dialogRef.componentInstance.data.userID,\n            amountToPay: dialogRef.componentInstance.data.amountToPay\n          });\n        },\n      }\n    });\n    \n    \n    dialogRef.afterClosed().subscribe(result => {\n      if (result) {\n        const userID = result.userID;\n        const amountToPay = result.amountToPay;\n        this.createBuy(userID, amountToPay, this.selectedProducts);\n      }\n    });\n    \n  }\n  showSnackBar(message: string) {\n    this.snackBar.open(message, 'Cerrar', {\n      duration: 5000,\n      horizontalPosition: 'center',\n      verticalPosition: 'top',\n    });\n  }\n\n  createBuy(clientCode: string, payment: number, selectedProducts: Product[]){\n    var productsRequest: ProductRequest[] = [];\n    var productSelected: ProductRequest;\n\n    selectedProducts.forEach(product => {\n      productSelected = {'product': product.id, 'quantity': product.quantity };\n      productsRequest.push(productSelected);\n    });    \n\n    var buyRequest: BuyRequest = {\n      'client_code': clientCode,\n      'payment': payment,\n      'products': productsRequest\n    }\n\n    this.apiService.createBuy(buyRequest).subscribe(\n      (response) => {\n        let successMessage = '¡Compra realizada exitosamente!';\n        \n        if (response.Data && response.Data.remaining_amount !== 0) {\n          successMessage += ` Recuerda que quedan pendiente el pago de $${response.Data.remaining_amount} pesos`;\n        }\n        \n        this.showSuccessAlert('Éxito', successMessage);\n        this.resetAndFetchProducts();\n      },\n      (error) => {\n        let errorMessage = error.error.Message.client_code[0];\n    \n        if (errorMessage.includes('There is no user with code')) {\n          const clientCode = buyRequest.client_code;\n          errorMessage = `No existe un usuario registrado con el código ${clientCode}, revisa los datos e intenta nuevamente`;\n        }\n    \n        this.showErrorAlert('Error', errorMessage);\n      }\n    );\n    \n    \n    \n    \n  }\n\n  showSuccessAlert(title: string, text: string) {\n    Swal.fire({\n      title: title,\n      text: text,\n      icon: 'success',\n      confirmButtonText: 'Aceptar',\n      customClass: {\n        container: 'custom-alert',\n      },\n    });\n  }\n\n  showErrorAlert(title: string, text: string) {\n    Swal.fire({\n      title: title,\n      text: text,\n      icon: 'error',\n      confirmButtonText: 'Aceptar',\n      customClass: {\n        container: 'custom-alert',\n      },\n    });\n  }\n\n  \n  \n}","<div class=\"flex h-full\">\n  <div class=\"grid grid-cols-3 gap-4 w-3/4 h-full overflow-auto\">\n    <div\n      *ngFor=\"let product of products\"\n      class=\"border p-4 rounded shadow\"\n      (click)=\"selectProduct(product)\"\n      [ngClass]=\"{ 'bg-green-100': product.selected }\"\n    >\n      <img [src]=\"product.image\" class=\"h-32 w-32 mx-auto mb-4\" />\n      <p class=\"font-semibold text-lg\">{{ product.name }}</p>\n      <p>Precio: ${{ product.sale_price }}</p>\n      <p [ngClass]=\"{'text-red-500': product.stock === 0}\">Stock: {{ product.stock }}</p>\n    </div>\n  </div>\n\n  <div class=\"border-l w-1/4 p-4 h-full sticky top-0 flex flex-col\">\n    <h2 class=\"text-xl font-semibold mb-4\">Productos seleccionados</h2>\n    <div class=\"selected-products flex-grow\">\n      <div *ngFor=\"let product of selectedProducts; index as i\" class=\"mb-4\">\n        <div class=\"grid grid-cols-6 gap-2 items-center\">\n          <img [src]=\"product.image\" class=\"h-16 w-16 col-span-1\" />\n          <div class=\"col-span-3\">\n            <p>{{ product.name }}</p>\n            <p class=\"text-sm text-gray-500\">x{{ product.quantity }}</p>\n          </div>\n          <button (click)=\"addProduct(product)\" class=\"bg-blue-500 text-white px-2 py-1 rounded col-span-1\">+</button>\n          <button (click)=\"subtractProduct(product, i)\" class=\"bg-red-500 text-white px-2 py-1 rounded col-span-1\">-</button>\n        </div>\n        <div class=\"flex justify-between\">\n          <p>Precio unitario: ${{ product.sale_price }}</p>\n          <p>Precio total: ${{ product.sale_price * product.quantity! }}</p>\n        </div>\n      </div>\n    </div>\n    <div class=\"border-t mt-4 pt-4\">\n      <p class=\"font-semibold\">Total: ${{ getTotal() }}</p>\n      <button\n      mat-raised-button\n      color=\"primary\"\n      class=\"w-full my-4 py-2 text-lg font-bold\"\n      (click)=\"openPurchaseSummaryDialog()\">\n      Comprar\n    </button>    \n    </div>\n  </div>\n</div>\n\n\n<div class=\"flex h-full\" [ngClass]=\"{'dark': (themeService.isDarkTheme$ | async)}\">\n  <!-- El resto del contenido HTML aquí -->\n</div>\n"]},"metadata":{},"sourceType":"module","externalDependencies":[]}